<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>금액별 스쿼드</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.14.0-beta2/css/bootstrap-select.min.css">
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      padding-top: 60px;
      background: #f5f5f5;
    }
    .input-group {
      margin-bottom: 15px;
    }
    input[type="text"] {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      box-sizing: border-box;
      margin-bottom: 20px;
    }
    /* 팀 아이템 컨테이너 */
    .team-item {
      margin-bottom: 20px;
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 4px;
      overflow: hidden;
    }
    /* 팀 버튼 */
    .team-btn {
      width: 100%;
      text-align: left;
      background: #f7f7f7;
      border: none;
      padding: 10px;
      font-size: 16px;
      cursor: pointer;
    }
    .team-btn:hover {
      background: #eaeaea;
    }
    /* 가격 옵션 컨테이너 (팀 내부에 인덴트 적용) */
    .price-options {
      display: none;
      border-top: 1px solid #ddd;
      background: #fff;
      padding-left: 20px;
    }
    .price-options .price-btn {
      width: 100%;
      text-align: left;
      border: none;
      padding: 10px;
      font-size: 15px;
      cursor: pointer;
      background: #fff;
    }
    .price-options .price-btn:not(:last-child) {
      border-bottom: 1px solid #ddd;
    }
    .price-btn:hover {
      background: #f0f0f0;
    }
    /* 스쿼드 이미지와 버튼 그룹 영역 */
    .squad-display {
      text-align: center;
      margin-top: 10px;
      padding: 10px;
      border-top: 1px solid #ddd;
    }
    .squad-display img {
      max-width: 100%;
      height: auto;
    }
    /* 네비게이션 바 */
    #navbar {
      background: #73685d;
      padding: 0.3rem 1rem;
    }
  </style>
</head>
<body>
  <nav id="navbar" class="navbar navbar-expand-lg navbar-dark fixed-top">
    <div class="container-fluid">
      <a class="navbar-brand" href="#" id="toolTabButton">FC모바일 금액별 스쿼드</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarContent">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="https://kritikal619.github.io/card/" target="_blank">피모합성소</a></li>
          <li class="nav-item"><a class="nav-link" href="https://kritikal619.github.io/trait/" target="_blank">피모 특성</a></li>
          <li class="nav-item"><a class="nav-link" href="http://fcevol.kro.kr" target="_blank">진화 시뮬레이션</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- 상단 검색창 -->
  <div class="input-group">
    <input type="text" id="search" placeholder="예: 레알 마드리드 1000 (엔터키로 검색)">
  </div>

  <!-- 팀 목록 영역 -->
  <div id="teamsContainer"></div>

  <script>
    // 데이터: GitHub 레포 내 이미지 파일 경로 사용 (상대경로 예시)
    const data = {
      team1: {
        name: "레알 마드리드",
        prices: {
          '500': './images/500억레알.png',
          '1000': './images/1000억레알.png',
          '3000': './images/3000억레알.png',
          '8000': './images/8000억레알.png',
          '20000': './images/20000억레알.png',
          '하이엔드': './images/하이엔드레알.png'
        }
      },
      team2: {
        name: "팀 2",
        prices: {
          '1500': './images/team2-price1500.png',
          '2500': './images/team2-price2500.png'
        }
      }
    };

    const teamsContainer = document.getElementById('teamsContainer');
    const searchInput = document.getElementById('search');
    const teamElements = {};

    Object.keys(data).forEach(teamKey => {
      const teamItem = document.createElement('div');
      teamItem.className = 'team-item';

      const teamBtn = document.createElement('button');
      teamBtn.className = 'team-btn';
      teamBtn.textContent = data[teamKey].name;
      teamBtn.dataset.team = teamKey;
      teamItem.appendChild(teamBtn);

      const priceOptions = document.createElement('div');
      priceOptions.className = 'price-options';
      teamItem.appendChild(priceOptions);

      const squadDisplay = document.createElement('div');
      squadDisplay.className = 'squad-display';
      squadDisplay.dataset.activePrice = "";
      teamItem.appendChild(squadDisplay);

      teamBtn.addEventListener('click', function() {
        // 닫기: 다른 팀들의 가격 옵션 닫기
        document.querySelectorAll('.price-options').forEach(div => {
          if (div !== priceOptions) {
            div.style.display = 'none';
            const otherSquad = div.parentElement.querySelector('.squad-display');
            otherSquad.innerHTML = '';
            otherSquad.dataset.activePrice = "";
          }
        });
        // 토글: 가격 옵션 열기/닫기
        if (priceOptions.style.display === 'block') {
          priceOptions.style.display = 'none';
          squadDisplay.innerHTML = '';
          squadDisplay.dataset.activePrice = "";
        } else {
          if (!priceOptions.hasChildNodes()) {
            Object.keys(data[teamKey].prices).forEach(price => {
              const priceBtn = document.createElement('button');
              priceBtn.className = 'price-btn';
              priceBtn.textContent = price + '억';
              priceBtn.dataset.team = teamKey;
              priceBtn.dataset.price = price;
              priceBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                const team = this.dataset.team;
                const price = this.dataset.price;
                const imgUrl = data[team].prices[price];
                // 토글: 동일 가격이면 삭제
                if (squadDisplay.dataset.activePrice === price) {
                  squadDisplay.innerHTML = '';
                  squadDisplay.dataset.activePrice = "";
                } else {
                  squadDisplay.innerHTML = '';
                  // 이미지 추가
                  const img = document.createElement('img');
                  img.src = imgUrl;
                  img.alt = data[team].name + ' 스쿼드';
                  squadDisplay.appendChild(img);

                  // 다운로드, 공유 버튼을 담을 그룹 생성
                  const btnGroup = document.createElement('div');
                  btnGroup.className = 'btn-group mt-2 d-block';
                  
                  // 다운로드 버튼
                  const downloadBtn = document.createElement('a');
                  downloadBtn.className = 'btn btn-primary';
                  downloadBtn.href = imgUrl;
                  downloadBtn.download = '';  // 파일 다운로드
                  downloadBtn.innerText = '다운로드';
                  
                  // 공유 버튼
                  const shareBtn = document.createElement('button');
                  shareBtn.className = 'btn btn-secondary';
                  shareBtn.innerText = '공유';
                  shareBtn.addEventListener('click', function() {
                    if (navigator.share) {
                      navigator.share({
                        title: data[team].name + ' 스쿼드',
                        url: imgUrl
                      }).catch(err => console.error("공유 실패:", err));
                    } else {
                      prompt("공유 링크를 복사하세요:", imgUrl);
                    }
                  });
                  
                  btnGroup.appendChild(downloadBtn);
                  btnGroup.appendChild(shareBtn);
                  // 이미지 바로 아래에 버튼 그룹 추가
                  squadDisplay.appendChild(btnGroup);
                  
                  squadDisplay.dataset.activePrice = price;
                }
              });
              priceOptions.appendChild(priceBtn);
            });
          }
          priceOptions.style.display = 'block';
        }
      });

      teamsContainer.appendChild(teamItem);
      teamElements[teamKey] = { teamItem, teamBtn, priceOptions, squadDisplay };
    });

    searchInput.addEventListener('keypress', function(e) {
      if (e.key === "Enter") {
        processSearch();
      }
    });

    function processSearch() {
      const query = searchInput.value.trim().toLowerCase();
      if (!query) return;
      let foundTeamKey = null;
      let foundPrice = null;
      Object.keys(data).forEach(teamKey => {
        const teamName = data[teamKey].name.toLowerCase();
        if (query.indexOf(teamName) > -1) {
          foundTeamKey = teamKey;
        }
      });
      const priceMatch = query.match(/\d+/);
      if (priceMatch) {
        foundPrice = priceMatch[0];
      }
      if (foundTeamKey) {
        const { teamItem, teamBtn, priceOptions, squadDisplay } = teamElements[foundTeamKey];
        if (priceOptions.style.display !== 'block') {
          teamBtn.click();
        }
        teamItem.scrollIntoView({ behavior: 'smooth', block: 'start' });
        if (foundPrice) {
          setTimeout(() => {
            const priceBtns = priceOptions.querySelectorAll('.price-btn');
            priceBtns.forEach(btn => {
              if (btn.dataset.price === foundPrice) {
                btn.click();
              }
            });
          }, 300);
        }
      }
    }
  </script>
</body>
</html>
